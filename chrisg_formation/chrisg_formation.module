<?php
// $Id$

/**
 * Implementation of hook_menu
 */

function chrisg_formation_menu () {
  $items = array();
  
  $items['formation/chrisg'] = array(
    'title' => 'ChrisG Formation',
    'description' => 'Invoking modules...',
    'page callback' => 'chrisg_formation_page_content',
    'page arguments' => array(0, 1),
    'access arguments' => array('access content'),
    'type' => MENU_NORMAL_ITEM,
  );

  return $items;
}

/**
 * Callback for my page
 */

function chrisg_formation_page_content ($a, $b) {
  $output = '';

  $output .= drupal_get_form('chrisg_simpleform');

  $menus = module_invoke_all('menu');
  $path = $a . '/' . $b;
  $menus = $menus[$path];
  $output .= '<pre>' . var_export($menus, true) . '</pre>';

  $output .= chrisg_formation_get_data();

  return $output;
}

/**
 * Get some data from the database
 */

function chrisg_formation_get_data() {
  $result = db_query('SELECT name, uid FROM users');

  $output = '<ul>';

  while ($row = db_fetch_array($result)) {
    $output .= "<li>{$row['name']} :: {$row['uid']}</li>";
  }

  $output .= '</ul>';

  return $output;
}

/**
 * A form? Yes, a form
 */

function chrisg_simpleform($form_state) {
  $form = array();

  $form['simplefield'] = array(
    '#type' => 'textfield',
    '#title' => 'A Simple Textfield',
    '#default_value' => 'really, just a simple textfield with a default value',
  );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'GO!',
  );

  return $form;  
}


/**
 * Validate!
 */

function chrisg_simpleform_validate($form, &$form_state) {
  $allowed_options = _chris_simpleform_allowed_values();
  if (!in_array($form_state['values']['simplefield'], $allowed_options)) {
    form_set_error('simplefield', t('Nope, try again!'));
    dsm('you submitted: ' . $form_state['values']['simplefield']);
    dsm('try one of: ' . implode(' or ', $allowed_options));
  }
  
}

/**
 * Helper function to generate allowed values
 */

function _chris_simpleform_allowed_values() {
  return array('go','stop');
}


/**
 * implementation of hook_form_FORM_ID_alter
 */
function chrisg_formation_form_sfyn_formation_blabla_alter(&$form, &$form_state) {
  $form['passion']['#options']['habs'] = 'Le Tricolore!';
  $current_defaults = $form['passion']['#default_value'];
  $form['passion']['#default_value'] = array($current_defaults, 'habs');

}
